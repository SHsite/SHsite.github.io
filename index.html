<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>팀 효과성 진단 리포트 생성기 | Learn² Consulting</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        /* Custom styles for better aesthetics */
        body {
            font-family: 'Inter', 'Pretendard', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            transition: all 0.3s ease-in-out;
        }
        .btn {
            transition: background-color 0.3s, transform 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        #report-output {
            animation: fadeIn 0.8s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <!-- Header Section with Learn2 Consulting Logo -->
        <div class="flex flex-col sm:flex-row justify-center items-center mb-8 text-center sm:text-left">
            <!-- 로고가 보이지 않는 문제를 해결하기 위해 안정적인 이미지 URL로 변경했습니다. -->
            <img src="https://i.imgur.com/rS25sJg.png" alt="Learn2 Consulting Logo" class="h-16 mb-4 sm:mb-0 sm:mr-6">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900">팀 효과성 진단 리포트</h1>
                <p class="mt-1 text-md text-gray-500">Provided by Learn² Consulting</p>
            </div>
        </div>


        <!-- Input Section -->
        <div class="card grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div>
                <label for="logoUpload" class="block text-sm font-medium text-gray-700 mb-1">1. 진단 대상 회사 로고</label>
                <input type="file" id="logoUpload" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
            </div>
            <div>
                <label for="dataUpload" class="block text-sm font-medium text-gray-700 mb-1">2. 설문 데이터 (CSV)</label>
                <input type="file" id="dataUpload" accept=".csv" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100">
            </div>
            <div>
                <label for="surveyPeriod" class="block text-sm font-medium text-gray-700 mb-1">3. 설문 기간</label>
                <input type="text" id="surveyPeriod" placeholder="예: 2025.07.01 ~ 2025.07.15" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
        </div>

        <!-- Action Button -->
        <div class="text-center">
            <button id="generateReport" class="btn bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                리포트 생성하기
            </button>
        </div>

        <!-- Report Output Section (Initially Hidden) -->
        <div id="report-output" class="mt-10" style="display:none;">
            <!-- Report Header -->
            <div class="card mb-8 flex flex-col md:flex-row justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">팀 효과성 진단 리포트</h2>
                    <p id="reportPeriod" class="text-md text-gray-600 mt-1"></p>
                </div>
                <img id="reportLogo" src="" alt="진단 대상 회사 로고" class="max-h-16 mt-4 md:mt-0" style="display:none;">
            </div>

            <!-- Executive Summary -->
            <div class="card mb-8">
                <h3 class="text-xl font-bold mb-4 border-b pb-2">종합 분석 (Executive Summary)</h3>
                <div id="summary-content" class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                    <!-- Summary data will be injected here -->
                </div>
            </div>

            <!-- Radar Chart for Overall View -->
            <div class="card mb-8">
                <h3 class="text-xl font-bold mb-4 border-b pb-2">영역별 효과성 분석</h3>
                <div class="w-full h-96 mx-auto">
                    <canvas id="radarChart"></canvas>
                </div>
            </div>

            <!-- Detailed Bar Charts -->
            <div class="card">
                <h3 class="text-xl font-bold mb-4 border-b pb-2">세부 문항 분석</h3>
                <div id="detail-charts" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Detailed charts will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Store chart instances to destroy them before re-rendering
        let chartInstances = {};

        document.getElementById('generateReport').addEventListener('click', () => {
            const logoFile = document.getElementById('logoUpload').files[0];
            const dataFile = document.getElementById('dataUpload').files[0];
            const surveyPeriod = document.getElementById('surveyPeriod').value;

            if (!dataFile || !surveyPeriod) {
                alert('설문 데이터(CSV)와 설문 기간을 모두 입력해주세요.');
                return;
            }

            // Destroy previous charts if they exist
            Object.values(chartInstances).forEach(chart => chart.destroy());
            chartInstances = {};

            // Show report section
            const reportOutput = document.getElementById('report-output');
            reportOutput.style.display = 'block';

            // 1. Render Logo and Period
            if (logoFile) {
                document.getElementById('reportLogo').src = URL.createObjectURL(logoFile);
                document.getElementById('reportLogo').style.display = 'block';
            } else {
                document.getElementById('reportLogo').style.display = 'none';
            }
            document.getElementById('reportPeriod').innerText = `진단 기간: ${surveyPeriod}`;

            // 2. Parse CSV and generate report
            Papa.parse(dataFile, {
                header: true,
                skipEmptyLines: true,
                dynamicTyping: true,
                complete: (results) => {
                    try {
                        const reportData = processData(results.data);
                        renderReport(reportData);
                    } catch (error) {
                        console.error("데이터 처리 중 오류 발생:", error);
                        alert("데이터를 처리하는 중 오류가 발생했습니다. CSV 파일 형식과 'processData' 함수를 확인해주세요.");
                    }
                },
                error: (error) => {
                    alert('CSV 파일을 파싱하는 중 오류가 발생했습니다.');
                    console.error('PapaParse Error:', error);
                }
            });
        });

        /**
         * @IMPORTANT
         * This is the core data processing function.
         * You MUST customize this function based on your team effectiveness model and CSV structure.
         * 이 함수는 데이터 처리의 핵심입니다.
         * 사용하시는 팀 효과성 모델과 CSV 구조에 맞게 반드시 수정하셔야 합니다.
         */
        function processData(rawData) {
            // --- CUSTOMIZATION AREA ---
            // 1. Define your effectiveness model dimensions.
            // 1. 효과성 모델의 영역을 정의합니다.
            const dimensions = {
                '심리적 안정감': ['Q1', 'Q2', 'Q3'],
                '상호 의존성': ['Q4', 'Q5'],
                '목표와 구조': ['Q6', 'Q7', 'Q8'],
                '업무의 의미': ['Q9', 'Q10'],
                '영향력': ['Q11', 'Q12']
            };

            const questionLabels = {
                'Q1': '팀 안에서 실수해도 괜찮다는 생각이 든다.',
                'Q2': '팀원들은 서로의 약점을 이용하지 않을 것이라 믿는다.',
                'Q3': '자유롭게 아이디어를 제안할 수 있는 분위기다.',
                'Q4': '팀의 성공을 위해 동료의 도움이 필수적이다.',
                'Q5': '팀원들과 협업하는 과정이 즐겁다.',
                'Q6': '우리 팀의 목표는 명확하고 구체적이다.',
                'Q7': '팀에서 나의 역할과 책임이 무엇인지 명확히 안다.',
                'Q8': '팀의 업무 프로세스는 효율적이다.',
                'Q9': '내가 하는 일은 팀과 조직에 중요하다고 느낀다.',
                'Q10': '나는 이 일을 통해 개인적으로 성장하고 있다.',
                'Q11': '우리 팀의 업무 결과는 조직에 긍정적인 영향을 준다.',
                'Q12': '나는 우리 팀이 만들어내는 결과에 자부심을 느낀다.'
            };
            // --- END CUSTOMIZATION AREA ---

            const dimensionScores = {};
            const questionScores = {};

            // Initialize scores
            for (const dim in dimensions) {
                dimensionScores[dim] = [];
                dimensions[dim].forEach(q => {
                    questionScores[q] = [];
                });
            }

            // Calculate scores from raw data
            rawData.forEach(row => {
                for (const dim in dimensions) {
                    dimensions[dim].forEach(q => {
                        if (row[q] !== undefined && row[q] !== null && !isNaN(row[q])) {
                            questionScores[q].push(row[q]);
                        }
                    });
                }
            });

            const avgDimensionScores = {};
            const avgQuestionScores = {};
            let totalScores = [];

            // Calculate averages
            for (const dim in dimensions) {
                let dimTotal = [];
                dimensions[dim].forEach(q => {
                    if (questionScores[q].length > 0) {
                        const sum = questionScores[q].reduce((a, b) => a + b, 0);
                        const avg = sum / questionScores[q].length;
                        avgQuestionScores[q] = avg;
                        dimTotal = dimTotal.concat(questionScores[q]);
                    } else {
                         avgQuestionScores[q] = 0;
                    }
                });
                if (dimTotal.length > 0) {
                    const dimSum = dimTotal.reduce((a, b) => a + b, 0);
                    avgDimensionScores[dim] = dimSum / dimTotal.length;
                } else {
                    avgDimensionScores[dim] = 0;
                }
                totalScores.push(avgDimensionScores[dim]);
            }
            
            const overallScore = totalScores.length > 0 ? totalScores.reduce((a, b) => a + b, 0) / totalScores.length : 0;

            return {
                dimensions,
                questionLabels,
                dimensionScores: avgDimensionScores,
                questionScores: avgQuestionScores,
                overallScore
            };
        }

        function renderReport(reportData) {
            renderSummary(reportData);
            renderRadarChart(reportData);
            renderDetailCharts(reportData);
        }

        function renderSummary(reportData) {
            const { overallScore, dimensionScores } = reportData;
            const summaryContent = document.getElementById('summary-content');
            
            const scores = Object.entries(dimensionScores);
            if(scores.length === 0) return;

            const strength = scores.reduce((max, item) => item[1] > max[1] ? item : max, scores[0]);
            const weakness = scores.reduce((min, item) => item[1] < min[1] ? item : min, scores[0]);

            summaryContent.innerHTML = `
                <div class="p-4 bg-blue-50 rounded-lg">
                    <h4 class="text-sm font-semibold text-blue-800">종합 점수</h4>
                    <p class="text-3xl font-bold text-blue-600 mt-1">${overallScore.toFixed(2)}</p>
                </div>
                <div class="p-4 bg-green-50 rounded-lg">
                    <h4 class="text-sm font-semibold text-green-800">가장 큰 강점</h4>
                    <p class="text-xl font-bold text-green-600 mt-2">${strength[0]}</p>
                    <p class="text-2xl font-bold text-green-600">${strength[1].toFixed(2)}</p>
                </div>
                <div class="p-4 bg-red-50 rounded-lg">
                    <h4 class="text-sm font-semibold text-red-800">개선 필요 영역</h4>
                    <p class="text-xl font-bold text-red-600 mt-2">${weakness[0]}</p>
                    <p class="text-2xl font-bold text-red-600">${weakness[1].toFixed(2)}</p>
                </div>
            `;
        }

        function renderRadarChart(reportData) {
            const { dimensionScores } = reportData;
            const ctx = document.getElementById('radarChart').getContext('2d');
            chartInstances.radar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: Object.keys(dimensionScores),
                    datasets: [{
                        label: '팀 효과성 점수',
                        data: Object.values(dimensionScores).map(score => score.toFixed(2)),
                        fill: true,
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        pointBackgroundColor: 'rgba(59, 130, 246, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(59, 130, 246, 1)'
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { display: true },
                            suggestedMin: 0,
                            suggestedMax: 5, // Assuming a 5-point scale
                            pointLabels: {
                                font: { size: 14 }
                            },
                            ticks: {
                                backdropColor: 'transparent',
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        function renderDetailCharts(reportData) {
            const { dimensions, questionScores, questionLabels } = reportData;
            const detailChartsContainer = document.getElementById('detail-charts');
            detailChartsContainer.innerHTML = ''; // Clear previous charts

            Object.entries(dimensions).forEach(([dim, questions]) => {
                const chartWrapper = document.createElement('div');
                chartWrapper.className = 'p-4 border rounded-lg bg-white';
                
                const title = document.createElement('h4');
                title.className = 'text-lg font-semibold mb-3 text-center';
                title.innerText = dim;
                chartWrapper.appendChild(title);

                const canvas = document.createElement('canvas');
                chartWrapper.appendChild(canvas);
                detailChartsContainer.appendChild(chartWrapper);

                const chartData = {
                    labels: questions.map(q => (questionLabels[q] || q).replace(/ /g, '\n')), // Wrap text
                    datasets: [{
                        label: '평균 점수',
                        data: questions.map(q => questionScores[q].toFixed(2)),
                        backgroundColor: questions.map(q => questionScores[q] < 3.5 ? 'rgba(239, 68, 68, 0.6)' : 'rgba(34, 197, 94, 0.6)'),
                        borderColor: questions.map(q => questionScores[q] < 3.5 ? 'rgba(239, 68, 68, 1)' : 'rgba(34, 197, 94, 1)'),
                        borderWidth: 1
                    }]
                };

                chartInstances[`detail_${dim}`] = new Chart(canvas.getContext('2d'), {
                    type: 'bar',
                    data: chartData,
                    options: {
                        indexAxis: 'y', // Horizontal bar chart
                        scales: {
                            x: {
                                beginAtZero: true,
                                max: 5 // Assuming 5-point scale
                            },
                            y: {
                                ticks: {
                                    autoSkip: false,
                                    font: {
                                        size: 10
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        maintainAspectRatio: false
                    }
                });
            });
        }
    </script>
</body>
</html>
